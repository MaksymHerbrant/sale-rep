# Архітектура системи: C++ як ядро аналітики

## 🎯 Концепція

**C++ модуль є ядром обчислень аналітики** - вся важка аналітика обчислюється в C++, а Django використовує результати для відображення.

## 📊 Схема роботи

```
┌─────────────────────────────────────────────────────────┐
│                    Django (Python)                      │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 1. ОДИН запит до БД (prefetch_related)           │  │
│  │    SELECT sales + items + products + categories   │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
│                          ▼                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 2. Формування JSON з реальними даними            │  │
│  │    {                                              │  │
│  │      sales: [                                     │  │
│  │        {                                          │  │
│  │          id, date, total_amount,                 │  │
│  │          items: [                                 │  │
│  │            {product_id, product_name,            │  │
│  │             category_id, category_name,          │  │
│  │             quantity, price, subtotal}           │  │
│  │          ]                                        │  │
│  │        }                                          │  │
│  │      ]                                            │  │
│  │    }                                              │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
│                          ▼                              │
│              subprocess.run([cpp_executable])           │
│                          │                              │
└──────────────────────────┼──────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│              C++ Модуль (ЯДРО АНАЛІТИКИ)                │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 3. Парсинг JSON з stdin                          │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
│                          ▼                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 4. ОБЧИСЛЕННЯ АНАЛІТИКИ:                         │  │
│  │    • Агрегація по днях/тижнях/місяцях           │  │
│  │    • Топ товарів за виручкою/кількістю          │  │
│  │    • Частки по категоріях                       │  │
│  │    • Статистики (mean, median, std dev)         │  │
│  │    • ABC-аналіз                                  │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
│                          ▼                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 5. Вивід JSON в stdout                           │  │
│  │    {                                              │  │
│  │      daily_revenue, weekly_revenue,             │  │
│  │      monthly_revenue,                            │  │
│  │      top_products_by_revenue,                    │  │
│  │      top_products_by_quantity,                   │  │
│  │      category_shares,                            │  │
│  │      statistics,                                 │  │
│  │      abc_analysis                                │  │
│  │    }                                              │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
└──────────────────────────┼──────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    Django (Python)                      │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 6. Парсинг JSON відповіді                        │  │
│  └──────────────────────────────────────────────────┘  │
│                          │                              │
│                          ▼                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 7. Використання даних:                           │  │
│  │    • Побудова графіків (Chart.js)               │  │
│  │    • Генерація PDF звітів                       │  │
│  │    • Відображення в UI                          │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## 🔧 Технічні деталі

### Django → C++
- **Один запит** до БД з `prefetch_related` для оптимізації
- JSON містить **реальні дані**: product_id, category_id, quantity, price
- Передача через `subprocess.run()` з `stdin`

### C++ обчислення
- Парсинг JSON (спрощений, але достатній)
- Всі обчислення в пам'яті (швидко)
- Повернення структурованого JSON

### C++ → Django
- JSON через `stdout`
- Django парсить та використовує для UI/PDF

## ✅ Переваги архітектури

1. **Швидкість** - C++ обчислює швидше за Python
2. **Масштабованість** - легко додати нові алгоритми в C++
3. **Розділення відповідальності** - Django для UI, C++ для обчислень
4. **Тестування** - C++ модуль можна тестувати окремо
5. **Методика** - демонструє інтеграцію мов та алгоритмів

## 📈 Функціонал C++ модуля

1. ✅ Агрегація по днях/тижнях/місяцях
2. ✅ Топ товарів за виручкою та кількістю
3. ✅ Частки продажів по категоріях
4. ✅ Статистики (mean, median, std dev, min, max)
5. ✅ ABC-аналіз (A/B/C категорії)

## 🎓 Відповідність методичці

- ✅ **"методи/алгоритми/дані"** - C++ реалізує алгоритми обчислення
- ✅ **"експерименти"** - демонстрація інтеграції Python + C++
- ✅ **"аналітична система"** - ABC-аналіз та статистики

