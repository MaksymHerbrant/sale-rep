# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è C++ –º–æ–¥—É–ª—è –∑ Python

## üìç –î–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è C++ –∫–æ–¥

```
cpp_analytics/
‚îú‚îÄ‚îÄ analytics.cpp    # –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ C++
‚îú‚îÄ‚îÄ Makefile        # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó
‚îî‚îÄ‚îÄ analytics       # –°–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª
```

## üîß –Ø–∫ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è

```bash
cd cpp_analytics
make
```

–ê–±–æ –≤—Ä—É—á–Ω—É:
```bash
g++ -std=c++11 -Wall -O2 -o analytics analytics.cpp
```

## üîó –Ø–∫ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ Python

### 1. –í–∏–∫–ª–∏–∫ —á–µ—Ä–µ–∑ `subprocess` (store/views.py)

```python
def call_cpp_analytics(date_from_str, date_to_str):
    """–í–∏–∫–ª–∏–∫ C++ –º–æ–¥—É–ª—è –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏"""
    # –®–ª—è—Ö –¥–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É
    cpp_executable = os.path.join(settings.BASE_DIR, 'cpp_analytics', 'analytics')
    
    # –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
    input_data = {
        'sales': [
            {
                'id': sale.id,
                'total': float(sale.total_amount),
                'date': sale.created_at.strftime('%Y-%m-%d'),
            }
            for sale in sales
        ]
    }
    
    # –í–∏–∫–ª–∏–∫ C++ –ø—Ä–æ–≥—Ä–∞–º–∏ —á–µ—Ä–µ–∑ subprocess
    result = subprocess.run(
        [cpp_executable],
        input=json.dumps(input_data),  # JSON —á–µ—Ä–µ–∑ stdin
        capture_output=True,           # –ó–∞—Ö–æ–ø–ª—é—î–º–æ stdout/stderr
        text=True,                     # –¢–µ–∫—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º
        timeout=10                     # –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
    )
    
    # –ü–∞—Ä—Å–∏–Ω–≥ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    if result.returncode == 0:
        return json.loads(result.stdout)
    else:
        return {'error': result.stderr}
```

### 2. –î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

**–§—É–Ω–∫—Ü—ñ—è:** `analytics_data()` –≤ `store/views.py` (—Ä—è–¥–æ–∫ 636)

```python
@login_required
@user_passes_test(is_manager)
def analytics_data(request):
    """API –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏"""
    # ... –æ–±—Ä–æ–±–∫–∞ –¥–∞—Ç ...
    
    # –í–∏–∫–ª–∏–∫ C++ –º–æ–¥—É–ª—è
    cpp_data = call_cpp_analytics(date_from_str, date_to_str)
    
    return JsonResponse({
        'sales_by_date': sales_by_date_list,
        'category_sales': category_sales_list,
        'cpp_analytics': cpp_data,  # –î–∞–Ω—ñ –∑ C++
    })
```

**Endpoint:** `/api/analytics/?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD`

## üìä –©–æ —Ä–æ–±–∏—Ç—å C++ –º–æ–¥—É–ª—å (–Ø–î–†–û –ê–ù–ê–õ–Ü–¢–ò–ö–ò)

C++ –º–æ–¥—É–ª—å (`analytics.cpp`) —î **—è–¥—Ä–æ–º –æ–±—á–∏—Å–ª–µ–Ω—å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏** —ñ –≤–∏–∫–æ–Ω—É—î:

1. **–ê–≥—Ä–µ–≥–∞—Ü—ñ—è –ø—Ä–æ–¥–∞–∂—ñ–≤**:
   - –ü–æ –¥–Ω—è—Ö (`aggregateByDay`)
   - –ü–æ —Ç–∏–∂–Ω—è—Ö (`aggregateByWeek`)
   - –ü–æ –º—ñ—Å—è—Ü—è—Ö (`aggregateByMonth`)

2. **–¢–æ–ø —Ç–æ–≤–∞—Ä—ñ–≤**:
   - –ó–∞ –≤–∏—Ä—É—á–∫–æ—é (`topProductsByRevenue`)
   - –ó–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é (`topProductsByQuantity`)

3. **–ß–∞—Å—Ç–∫–∏ –ø—Ä–æ–¥–∞–∂—ñ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö** (`categoryShares`)
   - –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –≤—ñ–¥—Å–æ—Ç–æ–∫ –≤–∏—Ä—É—á–∫–∏ –ø–æ –∫–æ–∂–Ω—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** (`calculateStatistics`):
   - –°–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è (mean)
   - –ú–µ–¥—ñ–∞–Ω–∞ (median)
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è (std dev)
   - –ú—ñ–Ω—ñ–º—É–º —Ç–∞ –º–∞–∫—Å–∏–º—É–º

5. **ABC-–∞–Ω–∞–ª—ñ–∑** (`abcAnalysis`):
   - –ö–∞—Ç–µ–≥–æ—Ä—ñ—è A: 0-80% –≤–∏—Ä—É—á–∫–∏ (–∫–ª—é—á–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏)
   - –ö–∞—Ç–µ–≥–æ—Ä—ñ—è B: 80-95% –≤–∏—Ä—É—á–∫–∏ (–≤–∞–∂–ª–∏–≤—ñ —Ç–æ–≤–∞—Ä–∏)
   - –ö–∞—Ç–µ–≥–æ—Ä—ñ—è C: 95-100% –≤–∏—Ä—É—á–∫–∏ (–¥–æ–ø–æ–º—ñ–∂–Ω—ñ —Ç–æ–≤–∞—Ä–∏)

## üîÑ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö

### –í—Ö—ñ–¥ (Python ‚Üí C++):
Django —Ä–æ–±–∏—Ç—å **–û–î–ò–ù –∑–∞–ø–∏—Ç** –¥–æ –ë–î —ñ —Ñ–æ—Ä–º—É—î JSON –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏:
```json
{
  "sales": [
    {
      "id": 1,
      "date": "2025-12-28",
      "total_amount": 1500.50,
      "items": [
        {
          "product_id": 5,
          "product_name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω Samsung",
          "category_id": 1,
          "category_name": "–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞",
          "quantity": 2,
          "price": 15000.00,
          "subtotal": 30000.00
        },
        ...
      ]
    },
    ...
  ]
}
```

### –í–∏—Ö—ñ–¥ (C++ ‚Üí Python):
C++ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–≤–Ω—É –∞–Ω–∞–ª—ñ—Ç–∏–∫—É:
```json
{
  "daily_revenue": [
    {"date": "2025-12-28", "revenue": 1500.50},
    ...
  ],
  "weekly_revenue": [
    {"week": "2025-W52", "revenue": 5000.00},
    ...
  ],
  "monthly_revenue": [
    {"month": "2025-12", "revenue": 15000.00},
    ...
  ],
  "top_products_by_revenue": [
    {"product_name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω Samsung", "revenue": 50000.00},
    ...
  ],
  "top_products_by_quantity": [
    {"product_name": "–•–ª—ñ–± –±—ñ–ª–∏–π", "quantity": 150},
    ...
  ],
  "category_shares": [
    {"category": "–ï–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞", "share": 45.5},
    ...
  ],
  "statistics": {
    "mean": 1500.50,
    "median": 1200.00,
    "std_dev": 500.25,
    "min": 500.00,
    "max": 3000.00,
    "total_sales": 100
  },
  "abc_analysis": [
    {
      "product_name": "–°–º–∞—Ä—Ç—Ñ–æ–Ω Samsung",
      "revenue": 50000.00,
      "cumulative_percent": 35.5,
      "category": "A"
    },
    ...
  ]
}
```

## ‚öôÔ∏è –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î (–Ω–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞)

1. **Django** —Ä–æ–±–∏—Ç—å **–û–î–ò–ù –∑–∞–ø–∏—Ç** –¥–æ –ë–î –∑ `prefetch_related` –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
2. **Django** —Ñ–æ—Ä–º—É—î JSON –∑ **—Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏**: –ø—Ä–æ–¥–∞–∂—ñ + –ø–æ–∑–∏—Ü—ñ—ó (product_id, category_id, quantity, price)
3. **subprocess.run()** –∑–∞–ø—É—Å–∫–∞—î C++ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, –ø–µ—Ä–µ–¥–∞—î JSON —á–µ—Ä–µ–∑ `stdin`
4. **C++ (–Ø–î–†–û)** –æ–±—á–∏—Å–ª—é—î –≤—Å—é –∞–Ω–∞–ª—ñ—Ç–∏–∫—É:
   - –ê–≥—Ä–µ–≥–∞—Ü—ñ—é –ø–æ –¥–Ω—è—Ö/—Ç–∏–∂–Ω—è—Ö/–º—ñ—Å—è—Ü—è—Ö
   - –¢–æ–ø —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –≤–∏—Ä—É—á–∫–æ—é —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é
   - –ß–∞—Å—Ç–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (mean, median, std dev)
   - ABC-–∞–Ω–∞–ª—ñ–∑
5. **C++** –≤–∏–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `stdout` —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
6. **Django** —á–∏—Ç–∞—î `stdout`, –ø–∞—Ä—Å–∏—Ç—å JSON
7. **Django** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–∞–Ω—ñ –¥–ª—è:
   - –ü–æ–±—É–¥–æ–≤–∏ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ (Chart.js)
   - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—ó PDF –∑–≤—ñ—Ç—ñ–≤
   - –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ UI

## üöÄ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

- ‚úÖ –®–≤–∏–¥–∫—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (C++ —à–≤–∏–¥—à–∏–π –∑–∞ Python)
- ‚úÖ –ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ Python (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ subprocess
- ‚úÖ JSON —è–∫ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –æ–±–º—ñ–Ω—É

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –í–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª `analytics` –º–∞—î –±—É—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º
- –Ø–∫—â–æ —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `{'error': 'C++ –º–æ–¥—É–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`
- –¢–∞–π–º–∞—É—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: 10 —Å–µ–∫—É–Ω–¥

