# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è C++ –º–æ–¥—É–ª—è –∑ Python

## üìç –î–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è C++ –∫–æ–¥

```
cpp_analytics/
‚îú‚îÄ‚îÄ analytics.cpp    # –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ C++
‚îú‚îÄ‚îÄ Makefile        # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó
‚îî‚îÄ‚îÄ analytics       # –°–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª
```

## üîß –Ø–∫ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è

```bash
cd cpp_analytics
make
```

–ê–±–æ –≤—Ä—É—á–Ω—É:
```bash
g++ -std=c++11 -Wall -O2 -o analytics analytics.cpp
```

## üîó –Ø–∫ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ Python

### 1. –í–∏–∫–ª–∏–∫ —á–µ—Ä–µ–∑ `subprocess` (store/views.py)

```python
def call_cpp_analytics(date_from_str, date_to_str):
    """–í–∏–∫–ª–∏–∫ C++ –º–æ–¥—É–ª—è –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏"""
    # –®–ª—è—Ö –¥–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É
    cpp_executable = os.path.join(settings.BASE_DIR, 'cpp_analytics', 'analytics')
    
    # –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
    input_data = {
        'sales': [
            {
                'id': sale.id,
                'total': float(sale.total_amount),
                'date': sale.created_at.strftime('%Y-%m-%d'),
            }
            for sale in sales
        ]
    }
    
    # –í–∏–∫–ª–∏–∫ C++ –ø—Ä–æ–≥—Ä–∞–º–∏ —á–µ—Ä–µ–∑ subprocess
    result = subprocess.run(
        [cpp_executable],
        input=json.dumps(input_data),  # JSON —á–µ—Ä–µ–∑ stdin
        capture_output=True,           # –ó–∞—Ö–æ–ø–ª—é—î–º–æ stdout/stderr
        text=True,                     # –¢–µ–∫—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º
        timeout=10                     # –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
    )
    
    # –ü–∞—Ä—Å–∏–Ω–≥ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    if result.returncode == 0:
        return json.loads(result.stdout)
    else:
        return {'error': result.stderr}
```

### 2. –î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

**–§—É–Ω–∫—Ü—ñ—è:** `analytics_data()` –≤ `store/views.py` (—Ä—è–¥–æ–∫ 636)

```python
@login_required
@user_passes_test(is_manager)
def analytics_data(request):
    """API –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏"""
    # ... –æ–±—Ä–æ–±–∫–∞ –¥–∞—Ç ...
    
    # –í–∏–∫–ª–∏–∫ C++ –º–æ–¥—É–ª—è
    cpp_data = call_cpp_analytics(date_from_str, date_to_str)
    
    return JsonResponse({
        'sales_by_date': sales_by_date_list,
        'category_sales': category_sales_list,
        'cpp_analytics': cpp_data,  # –î–∞–Ω—ñ –∑ C++
    })
```

**Endpoint:** `/api/analytics/?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD`

## üìä –©–æ —Ä–æ–±–∏—Ç—å C++ –º–æ–¥—É–ª—å

C++ –º–æ–¥—É–ª—å (`analytics.cpp`) –æ–±—á–∏—Å–ª—é—î:

1. **–¢–æ–ø —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ –≤–∏—Ä—É—á–∫–æ—é** (`calculateTopProducts`)
   - –†–æ–∑–ø–æ–¥—ñ–ª—è—î –ø—Ä–æ–¥–∞–∂—ñ –ø–æ —Ç–æ–≤–∞—Ä–∞—Ö
   - –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î –∑–∞–≥–∞–ª—å–Ω—É –≤–∏—Ä—É—á–∫—É –ø–æ –∫–æ–∂–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É

2. **–ê–≥—Ä–µ–≥–∞—Ü—ñ—è –≤–∏—Ä—É—á–∫–∏ –ø–æ –¥–Ω—è—Ö** (`aggregateByDate`)
   - –ì—Ä—É–ø—É—î –ø—Ä–æ–¥–∞–∂—ñ –ø–æ –¥–∞—Ç–∞—Ö
   - –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î –∑–∞–≥–∞–ª—å–Ω—É –≤–∏—Ä—É—á–∫—É –∑–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å

3. **–ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (`statistics`)
   - –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ä—É—á–∫–∞
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–¥–∞–∂—ñ–≤
   - –°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫

## üîÑ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö

### –í—Ö—ñ–¥ (Python ‚Üí C++):
```json
{
  "sales": [
    {
      "id": 1,
      "total": 1500.50,
      "date": "2025-12-28"
    },
    ...
  ]
}
```

### –í–∏—Ö—ñ–¥ (C++ ‚Üí Python):
```json
{
  "top_products": [
    {"name": "–¢–æ–≤–∞—Ä A", "revenue": 500.00},
    ...
  ],
  "daily_revenue": [
    {"date": "2025-12-28", "total": 1500.50},
    ...
  ],
  "statistics": {
    "total_revenue": 1500.50,
    "total_sales": 1,
    "average_sale": 1500.50
  }
}
```

## ‚öôÔ∏è –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

1. **Python** —Ñ–æ—Ä–º—É—î JSON –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑ –ë–î
2. **subprocess.run()** –∑–∞–ø—É—Å–∫–∞—î C++ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª
3. **C++** —á–∏—Ç–∞—î JSON –∑ `stdin`, –æ–±—Ä–æ–±–ª—è—î –¥–∞–Ω—ñ
4. **C++** –≤–∏–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `stdout` —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
5. **Python** —á–∏—Ç–∞—î `stdout`, –ø–∞—Ä—Å–∏—Ç—å JSON —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–ª—ñ—î–Ω—Ç—É

## üöÄ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

- ‚úÖ –®–≤–∏–¥–∫—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (C++ —à–≤–∏–¥—à–∏–π –∑–∞ Python)
- ‚úÖ –ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ Python (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ subprocess
- ‚úÖ JSON —è–∫ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –æ–±–º—ñ–Ω—É

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –í–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª `analytics` –º–∞—î –±—É—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º
- –Ø–∫—â–æ —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `{'error': 'C++ –º–æ–¥—É–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`
- –¢–∞–π–º–∞—É—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: 10 —Å–µ–∫—É–Ω–¥

